<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¡çœ èˆªç­ç³»çµ±æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        button {
            background: linear-gradient(45deg, #00ff88, #00cc6f);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .result {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>âœˆï¸ ç¡çœ èˆªç­ç³»çµ±æ¸¬è©¦</h1>
        
        <div class="test-section">
            <h3>ğŸ• æ™‚é–“é¸æ“‡æ¸¬è©¦</h3>
            <button onclick="testTimeSelection()">æ¸¬è©¦æ™‚é–“é¸æ“‡</button>
            <div id="timeResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸŒ ç›®çš„åœ°è¨ˆç®—æ¸¬è©¦</h3>
            <button onclick="testDestinationCalculation()">æ¸¬è©¦ç›®çš„åœ°è¨ˆç®—</button>
            <div id="destinationResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸµ èªéŸ³å»£æ’­æ¸¬è©¦</h3>
            <button onclick="testAnnouncement()">æ¸¬è©¦ç™»æ©Ÿå»£æ’­</button>
            <button onclick="testLandingAnnouncement()">æ¸¬è©¦é™è½å»£æ’­</button>
            <div id="announcementResult" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ® éŠæˆ²æ•´åˆæ¸¬è©¦</h3>
            <button onclick="testGameIntegration()">æ¸¬è©¦éŠæˆ²æ•´åˆ</button>
            <div id="gameResult" class="result"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ“¬éŠæˆ²ç³»çµ±
        class TestGameSystem {
            constructor() {
                this.gameState = {
                    sleepFlightMode: true,
                    wakeTime: '08:00',
                    currentLocation: {
                        name: 'å°åŒ—',
                        country: 'å°ç£',
                        coordinates: [25.0330, 121.5654]
                    }
                };
            }

            async calculateSleepFlightDestinations(currentLocation, wakeTime) {
                // æ¨¡æ“¬APIèª¿ç”¨
                return [
                    {
                        id: 'tokyo',
                        name: 'æ±äº¬',
                        country: 'æ—¥æœ¬',
                        countryCode: 'JP',
                        flag: 'ğŸ‡¯ğŸ‡µ',
                        distance: 2100,
                        flightTime: 2.6,
                        coordinates: [35.6762, 139.6503],
                        price: 3000,
                        unlocked: true
                    },
                    {
                        id: 'seoul',
                        name: 'é¦–çˆ¾',
                        country: 'éŸ“åœ‹',
                        countryCode: 'KR',
                        flag: 'ğŸ‡°ğŸ‡·',
                        distance: 1800,
                        flightTime: 2.3,
                        coordinates: [37.5665, 126.9780],
                        price: 2800,
                        unlocked: true
                    }
                ];
            }

            async playSleepFlightAnnouncement(announcementType, destination) {
                const response = await fetch('/api/generateSleepFlightAnnouncement', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        announcementType: announcementType,
                        city: destination.name,
                        country: destination.country,
                        countryCode: destination.countryCode,
                        currentLocation: this.gameState.currentLocation.name,
                        flightTime: destination.flightTime,
                        wakeTime: this.gameState.wakeTime
                    })
                });

                const data = await response.json();
                return data.announcement;
            }
        }

        const testGame = new TestGameSystem();

        async function testTimeSelection() {
            const result = document.getElementById('timeResult');
            result.innerHTML = 'æ¸¬è©¦æ™‚é–“é¸æ“‡åŠŸèƒ½...';
            
            try {
                // æ¸¬è©¦ä¸åŒæ™‚é–“
                const times = ['06:00', '07:00', '08:00', '09:00', '10:00'];
                let output = 'æ™‚é–“é¸æ“‡æ¸¬è©¦çµæœï¼š\n';
                
                for (const time of times) {
                    const utcOffset = Math.round((parseInt(time.split(':')[0]) * 60 + parseInt(time.split(':')[1]) - 480) / 60);
                    output += `${time} â†’ UTCåç§»: ${utcOffset}\n`;
                }
                
                result.innerHTML = output;
            } catch (error) {
                result.innerHTML = `éŒ¯èª¤: ${error.message}`;
            }
        }

        async function testDestinationCalculation() {
            const result = document.getElementById('destinationResult');
            result.innerHTML = 'è¨ˆç®—å¯é”ç›®çš„åœ°...';
            
            try {
                const destinations = await testGame.calculateSleepFlightDestinations(
                    testGame.gameState.currentLocation,
                    testGame.gameState.wakeTime
                );
                
                let output = 'å¯é”ç›®çš„åœ°ï¼š\n';
                destinations.forEach(dest => {
                    output += `âœˆï¸ ${dest.flag} ${dest.name} (${dest.country})\n`;
                    output += `   è·é›¢: ${dest.distance}km, é£›è¡Œæ™‚é–“: ${dest.flightTime}h, ç¥¨åƒ¹: NT$ ${dest.price}\n`;
                });
                
                result.innerHTML = output;
            } catch (error) {
                result.innerHTML = `éŒ¯èª¤: ${error.message}`;
            }
        }

        async function testAnnouncement() {
            const result = document.getElementById('announcementResult');
            result.innerHTML = 'ç”Ÿæˆç™»æ©Ÿå»£æ’­...';
            
            try {
                const destination = {
                    name: 'æ±äº¬',
                    country: 'æ—¥æœ¬',
                    countryCode: 'JP',
                    flightTime: 2.6
                };
                
                const announcement = await testGame.playSleepFlightAnnouncement('boarding', destination);
                result.innerHTML = `ç™»æ©Ÿå»£æ’­ï¼š\n"${announcement}"`;
            } catch (error) {
                result.innerHTML = `éŒ¯èª¤: ${error.message}`;
            }
        }

        async function testLandingAnnouncement() {
            const result = document.getElementById('announcementResult');
            result.innerHTML = 'ç”Ÿæˆé™è½å»£æ’­...';
            
            try {
                const destination = {
                    name: 'æ±äº¬',
                    country: 'æ—¥æœ¬',
                    countryCode: 'JP',
                    flightTime: 2.6
                };
                
                const announcement = await testGame.playSleepFlightAnnouncement('landing', destination);
                result.innerHTML = `é™è½å»£æ’­ï¼š\n"${announcement}"`;
            } catch (error) {
                result.innerHTML = `éŒ¯èª¤: ${error.message}`;
            }
        }

        async function testGameIntegration() {
            const result = document.getElementById('gameResult');
            result.innerHTML = 'æ¸¬è©¦éŠæˆ²æ•´åˆ...';
            
            try {
                // æ¸¬è©¦å®Œæ•´çš„éŠæˆ²æµç¨‹
                let output = 'éŠæˆ²æ•´åˆæ¸¬è©¦ï¼š\n';
                
                // 1. æ™‚é–“é¸æ“‡
                output += '1. âœ… æ™‚é–“é¸æ“‡åŠŸèƒ½æ­£å¸¸\n';
                
                // 2. ç›®çš„åœ°è¨ˆç®—
                const destinations = await testGame.calculateSleepFlightDestinations(
                    testGame.gameState.currentLocation,
                    testGame.gameState.wakeTime
                );
                output += `2. âœ… ç›®çš„åœ°è¨ˆç®—æ­£å¸¸ (æ‰¾åˆ° ${destinations.length} å€‹ç›®çš„åœ°)\n`;
                
                // 3. èªéŸ³å»£æ’­
                const destination = destinations[0];
                const announcement = await testGame.playSleepFlightAnnouncement('boarding', destination);
                output += `3. âœ… èªéŸ³å»£æ’­æ­£å¸¸\n`;
                
                // 4. æ©Ÿç¥¨ç”Ÿæˆ
                const ticket = {
                    id: `ticket_${Date.now()}`,
                    destination: destination,
                    purchaseDate: new Date().toISOString(),
                    price: destination.price
                };
                output += `4. âœ… æ©Ÿç¥¨ç”Ÿæˆæ­£å¸¸ (ç¥¨è™Ÿ: ${ticket.id})\n`;
                
                output += '\nğŸ‰ æ‰€æœ‰åŠŸèƒ½æ¸¬è©¦é€šéï¼';
                result.innerHTML = output;
            } catch (error) {
                result.innerHTML = `éŒ¯èª¤: ${error.message}`;
            }
        }
    </script>
</body>
</html>
