<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wum-flight Web Component ç¤ºç¯„</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #fff;
            margin: 0;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .test-section {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        h3 {
            margin-top: 0;
            color: #00ff88;
            font-size: 16px;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px 5px 5px 0;
            border: none;
            border-radius: 5px;
            background: #00ff88;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }
        
        button:hover {
            background: #00cc6f;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        button.danger {
            background: #ff6b6b;
            color: white;
        }
        
        .log-output {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            color: #00ff88;
        }
        
        .log-line {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (max-width: 900px) {
            .layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>âœˆï¸ wum-flight Web Component ç¤ºç¯„</h1>
        
        <div class="layout">
            <!-- å·¦å´ï¼šæ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <div class="test-section">
                    <h3>ğŸ« ç”Ÿæˆç¥¨åˆ¸</h3>
                    
                    <div class="input-group">
                        <label>ä¸Šæ¬¡æ™‚é–“ (HHMMï¼Œç•™ç©ºè¡¨ç¤ºé¦–æ¬¡):</label>
                        <input type="text" id="prevTime" placeholder="0830">
                    </div>
                    
                    <div class="input-group">
                        <label>ç•¶å‰æ™‚é–“ (HHMM):</label>
                        <input type="text" id="currTime" placeholder="0912">
                    </div>
                    
                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="nightPenalty"> å¤œé–“æ‡²ç½° (+20%)
                        </label>
                        <label>
                            <input type="checkbox" id="streakBonus"> ç©©å®šç´…åˆ© (-10%)
                        </label>
                        <label>
                            <input type="checkbox" id="firstDayFree"> é¦–æ—¥å…æ‰£æ²¹
                        </label>
                    </div>
                    
                    <button onclick="generateTicket()">ğŸ« ç”Ÿæˆç¥¨åˆ¸</button>
                    <button onclick="useCurrentTime()" class="secondary">â° ä½¿ç”¨ç•¶å‰æ™‚é–“</button>
                </div>
                
                <div class="test-section">
                    <h3>âš¡ å¿«é€Ÿæ¸¬è©¦</h3>
                    <button onclick="testCase(null, '0830')">é¦–æ¬¡èµ·é£›</button>
                    <button onclick="testCase('0830', '0835')">+5åˆ†é˜</button>
                    <button onclick="testCase('0830', '0900')">+30åˆ†é˜</button>
                    <button onclick="testCase('0830', '0912')">+42åˆ†é˜</button>
                    <button onclick="testCase('0830', '1030')">+120åˆ†é˜</button>
                    <button onclick="testCase('0900', '0700')">æ—©èµ· -120åˆ†</button>
                </div>
                
                <div class="test-section">
                    <h3>â›½ Fuel ç®¡ç†</h3>
                    <button onclick="addFuel(20)">â• åŠ æ²¹ +20</button>
                    <button onclick="addFuel(-10)">â– æ‰£æ²¹ -10</button>
                    <button onclick="setFuelTo(100)" class="secondary">è¨­ç‚º 100</button>
                    <button onclick="setFuelTo(50)" class="secondary">è¨­ç‚º 50</button>
                </div>
                
                <div class="test-section">
                    <h3>ğŸ”§ ç³»çµ±æ§åˆ¶</h3>
                    <button onclick="resetToday()" class="secondary">é‡ç½®ä»Šå¤©æ¨™è¨˜</button>
                    <button onclick="resetAll()" class="danger">å®Œå…¨é‡ç½®</button>
                    <button onclick="showInfo()" class="secondary">é¡¯ç¤ºç‹€æ…‹</button>
                    <button onclick="clearLog()" class="secondary">æ¸…é™¤æ—¥èªŒ</button>
                </div>
                
                <div class="test-section">
                    <h3>ğŸ“Š æ—¥èªŒè¼¸å‡º</h3>
                    <div id="logOutput" class="log-output">
                        <div class="log-line">ç­‰å¾…æ“ä½œ...</div>
                    </div>
                </div>
            </div>
            
            <!-- å³å´ï¼šwum-flight é¡¯ç¤º -->
            <div>
                <wum-flight id="wumFlight"></wum-flight>
            </div>
        </div>
    </div>

    <script src="wum-flight.js"></script>
    <script>
        let api = null;
        
        // ç­‰å¾… Component å°±ç·’
        const wumFlight = document.getElementById('wumFlight');
        wumFlight.addEventListener('wum:ready', (e) => {
            api = e.detail.api;
            log('âœ… wum-flight å·²å°±ç·’');
            showInfo();
        });
        
        wumFlight.addEventListener('wum:ticket-generated', (e) => {
            log('ğŸ« ç¥¨åˆ¸å·²ç”Ÿæˆ', e.detail.ticket);
            log(`ğŸ’° ç•¶å‰ Fuel: ${e.detail.currentFuel} / 120`);
        });
        
        // ç”Ÿæˆç¥¨åˆ¸
        function generateTicket() {
            if (!api) {
                alert('API å°šæœªå°±ç·’');
                return;
            }
            
            const prevTime = document.getElementById('prevTime').value.trim() || null;
            const currTime = document.getElementById('currTime').value.trim();
            
            if (!currTime) {
                alert('è«‹è¼¸å…¥ç•¶å‰æ™‚é–“');
                return;
            }
            
            const opts = {
                currHHMM: currTime,
                prevHHMM: prevTime,
                nightPenalty: document.getElementById('nightPenalty').checked,
                streakBonus: document.getElementById('streakBonus').checked,
                firstDayFree: document.getElementById('firstDayFree').checked
            };
            
            log('ğŸ“¤ ç™¼é€ç”Ÿæˆè«‹æ±‚', opts);
            const ticket = api.generate(opts);
            
            if (ticket) {
                log('âœ… ç”ŸæˆæˆåŠŸ', ticket);
            }
        }
        
        // ä½¿ç”¨ç•¶å‰æ™‚é–“
        function useCurrentTime() {
            const now = new Date();
            const hhmm = String(now.getHours()).padStart(2, '0') + String(now.getMinutes()).padStart(2, '0');
            document.getElementById('currTime').value = hhmm;
            log(`â° ç•¶å‰æ™‚é–“: ${hhmm}`);
        }
        
        // æ¸¬è©¦æ¡ˆä¾‹
        function testCase(prev, curr) {
            document.getElementById('prevTime').value = prev || '';
            document.getElementById('currTime').value = curr;
            log(`ğŸ§ª æ¸¬è©¦æ¡ˆä¾‹: ${prev || 'é¦–æ¬¡'} â†’ ${curr}`);
            generateTicket();
        }
        
        // Fuel ç®¡ç†
        function addFuel(amount) {
            if (!api) return;
            const newFuel = api.getFuel() + amount;
            api.setFuel(newFuel);
            log(`â›½ Fuel èª¿æ•´: ${amount >= 0 ? '+' : ''}${amount} â†’ ${api.getFuel()}`);
        }
        
        function setFuelTo(value) {
            if (!api) return;
            api.setFuel(value);
            log(`â›½ Fuel è¨­å®šç‚º: ${value}`);
        }
        
        // ç³»çµ±æ§åˆ¶
        function resetToday() {
            if (!api) return;
            api.resetToday();
            log('ğŸ”„ ä»Šå¤©æ¨™è¨˜å·²é‡ç½®ï¼ˆå¯å†æ¬¡æ‰£æ²¹ï¼‰');
        }
        
        function resetAll() {
            if (!api) return;
            if (confirm('ç¢ºå®šè¦å®Œå…¨é‡ç½®ï¼Ÿé€™å°‡æ¸…é™¤æ‰€æœ‰è³‡æ–™ã€‚')) {
                api.resetAll();
                log('ğŸ”„ å·²å®Œå…¨é‡ç½®ï¼ˆFuel=100, æ­·å²æ¸…ç©ºï¼‰');
            }
        }
        
        function showInfo() {
            if (!api) return;
            const fuel = api.getFuel();
            const tickets = api.getTickets();
            const current = api.getCurrentTicket();
            
            log('ğŸ“Š ===== ç³»çµ±ç‹€æ…‹ =====');
            log(`ğŸ’° Fuel: ${fuel} / 120`);
            log(`ğŸ« æ­·å²ç¥¨åˆ¸æ•¸: ${tickets.length}`);
            log(`ğŸ“ ç•¶å‰ç¥¨åˆ¸:`, current);
            log(`ğŸ“¦ LocalStorage:`, {
                fuel: localStorage.getItem('WUM_FUEL'),
                lastHHMM: localStorage.getItem('WUM_LAST_HHMM'),
                lastDate: localStorage.getItem('WUM_LAST_DATE')
            });
            log('ğŸ“Š =====================');
        }
        
        // æ—¥èªŒç³»çµ±
        function log(message, data) {
            const logDiv = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const logLine = document.createElement('div');
            logLine.className = 'log-line';
            
            if (data) {
                logLine.textContent = `[${timestamp}] ${message}: ${JSON.stringify(data, null, 2)}`;
            } else {
                logLine.textContent = `[${timestamp}] ${message}`;
            }
            
            logDiv.insertBefore(logLine, logDiv.firstChild);
            
            // é™åˆ¶æ—¥èªŒæ•¸é‡
            while (logDiv.children.length > 50) {
                logDiv.removeChild(logDiv.lastChild);
            }
        }
        
        function clearLog() {
            document.getElementById('logOutput').innerHTML = '<div class="log-line">æ—¥èªŒå·²æ¸…é™¤</div>';
        }
        
        // åˆå§‹åŒ–ï¼šä½¿ç”¨ç•¶å‰æ™‚é–“
        document.addEventListener('DOMContentLoaded', () => {
            useCurrentTime();
        });
    </script>
</body>
</html>

